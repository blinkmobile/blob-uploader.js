/*
 * blob-uploader.js: v0.0.1 | https://github.com/blinkmobile/blob-uploader.js#readme
 * (c) 2017 BlinkMobile | Released under the MIT license
 */
!function(r,e){if("function"==typeof define&&define.amd)define(["module"],e);else if("undefined"!=typeof exports)e(module);else{var t={exports:{}};e(t),r.blobUploader=t.exports}}(this,function(r){"use strict";function e(r){if(!r)throw new TypeError("blobUploader expects a api URL during instansiation");t.set(this,{uri:r})}var t=new WeakMap;e.prototype.uploadBlob=function(r){var e=this;if(!r)return Promise.reject(new Error("blob argument not provided"));if(!t||!t.get(this))return Promise.reject(new Error("blobUploader uri not configured"));var o=t.get(this);if(!o||!o.hasOwnProperty("uri"))return Promise.reject(new Error("blobUploader uri not configured"));var n=new Request(o.uri,{method:"POST",mode:"cors"});return fetch(n).then(function(r){return r.ok?r.json():Promise.reject(new Error("Error calling blob api service: "+r.status+" "+r.statusText))}).then(function(t){return e._uploadToS3(r,t.putUrl),t.id}).catch(function(r){return Promise.reject(new Error("Error calling blob api service: "+r))})},e.prototype._uploadToS3=function(r,e){var t=new Request(e,{method:"PUT",mode:"cors",body:r});return fetch(t).then(function(r){if(!r.ok)return Promise.reject(Error("Error uploading to S3: "+r.status+" "+r.statusText))}).catch(function(r){return Promise.reject(new Error("Error uploading to S3: "+r))})},e.prototype.retrieveBlobUrl=function(r){if(!r)return Promise.reject(new Error("uuid argument not provided"));if(!t||!t.get(this))return Promise.reject(new Error("blobUploader uri not configured"));var e=t.get(this);if(!e||!e.hasOwnProperty("uri"))return Promise.reject(new Error("blobUploader uri not configured"));var o=new Request(e.uri+r,{method:"PUT",mode:"cors"});return fetch(o).then(function(r){return r.ok?r.json():Promise.reject(new Error("Error calling blob api service: "+r.status+" "+r.statusText))}).then(function(r){return r.getUrl}).catch(function(r){return Promise.reject(new Error("Error calling blob api service: "+r))})},r.exports=e});